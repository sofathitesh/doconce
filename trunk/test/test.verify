#!/usr/bin/env python
import commands, os

# recommendation: remove installation and reinstall (to test setup.py)

thisdir = os.getcwd()
tutdir = os.path.join(os.pardir, 'docs', 'tutorial')
print 'cd', tutdir
os.chdir(tutdir)

# testing doconce.py:
print '...running ./make.sh in docs/tutorial'  # works only under Unix...
failure = os.system('./clean.sh')
if failure:
    print output
    raise OSError, 'Could not run clean.sh successfully'    
failure = os.system('./make.sh')
if failure:
    print output
    raise OSError, 'Could not run make.sh successfully'    

def add(filename, logfile):
    print '...adding file', filename
    logfile.write("""
************** File: %s *****************
""" % filename)
    if not os.path.isfile(filename):
        logfile.write('NOT FOUND!')
    else:
        f = open(filename, 'r')
        fstr = f.read()
        f.close()
        logfile.write(fstr)

os.chdir('demo')
logfilename = os.path.join(os.pardir, os.pardir, os.pardir, 'test', 'test.v')
log = open(logfilename, 'w')
#log.write(output + '\n\n\n\n\n')
# concentrate on files generated by doconce (not rst2*.py):
files = '.do.txt', '.html', '.txt', '.rst', '.wiki', '.st', '.epytext', '.txt'
files = ['tutorial' + ext for ext in files]
for f in files:
    add(f, log)

# test DocWriter:
os.chdir(thisdir)
failure, output = commands.getstatusoutput('python ../lib/doconce/DocWriter.py')
files = 'tmp_Doconce.do.txt', 'tmp_DocWriter.do.txt', 'tmp_DocWriter.html', \
        'tmp_HTML.html'
for f in files:
    add(f, log)




