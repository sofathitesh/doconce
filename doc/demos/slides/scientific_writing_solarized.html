<?xml version="1.0" encoding="utf-8" ?>
<!--
Automatically generated HTML file from Doconce source
(http://code.google.com/p/doconce/)
-->

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Doconce: http://code.google.com/p/doconce/" />


<style type="text/css">
    body {
      margin:5;
      padding:0;
      border:0;	/* Remove the border around the viewport in old versions of IE */
      width:100%;
      background: #fdf6e3;
      min-width:600px;	/* Minimum width of layout - remove if not required */
      font-family: Verdana, Helvetica, Arial, sans-serif;
      font-size: 1.0em;
      line-height: 1.3em;
      color: #657b83;
    }
    a { color: #657b83; text-decoration:none; }
    a:hover { color: #b58900; background: #eee8d5; text-decoration:none; }
    h1, h2, h3 { margin:.8em 0 .2em 0; padding:0; line-height: 125%; }
    h2 { font-variant: small-caps; }
    pre {
      background: #fdf6e3;
      -webkit-box-shadow: inset 0 0 2px #000000;
      -moz-box-shadow: inset 0 0 2px #000000;
      box-shadow: inset 0 0 2px #000000;
      color: #586e75;
      margin-left: 0px;
      font-family: 'Droid Sans Mono', monospace;
      padding: 2px;
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      border-radius: 4px;
      -moz-background-clip: padding;
      -webkit-background-clip: padding-box;
      background-clip: padding-box;
    }
    tt { font-family: "Courier New", Courier; }
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    p { text-indent: 0px; }
    p.caption { width: 80%; font-style: normal; text-align: left; }
    hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}

    .notice, .summary, .warning, .hint, .question {
    border: 1px solid; margin: 10px 0px; padding:15px 10px 15px 50px;
    background-repeat: no-repeat; background-position: 10px center;
    }
    .notice   { background-image: url('https://doconce.googlecode.com/hg/bundled/html_images/Knob_Message.png'); }
    .summary  { background-image:url('https://doconce.googlecode.com/hg/bundled/html_images/Knob_Valid_Green.png'); }
    .warning  { background-image: url('https://doconce.googlecode.com/hg/bundled/html_images/Knob_Attention.png'); }
    .hint     { background-image: url('https://doconce.googlecode.com/hg/bundled/html_images/Knob_Info.png'); }
    .question { background-image:url('https://doconce.googlecode.com/hg/bundled/html_images/Knob_Forward.png'); }

</style>

</head>
<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- Fix slow MathJax rendering in IE8 -->
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">




<!-- ------------------- main content ------------------------>
    
<title>On the Technicalities of Scientific Writing Anno 2012: The Doconce Way</title>

<center><h1>On the Technicalities of Scientific Writing Anno 2012: The Doconce Way</h1></center>  <! -- document title -->

<p>
<! -- author(s) -->

<center>
<b>Hans Petter Langtangen</b> 
</center>


<p>
<!-- institution(s) -->



<p>
<center><h4>Jan 27, 2013</h4></center> <!-- date -->
<p>

<!-- !split -->

<h2>Scope  <a name="___sec0"></a></h2>
<p>
<!-- !bpop -->

<ul>
  <li> <em>Scientific writing</em> = lecture notes, slides, reports, thesis, books,  ...</li>
  <li> (Journal papers typeset by journals are out of scope)</li>
  <li> Scope: documents with much <em>math</em> and <em>computer code</em></li>
  <li> Key question: What tools should I use for writing?</li>
  <li> Default answer: LaTeX</li>
  <li> Alternative: MS Word w/math</li>
  <li> Recent popular alternative tools: Sphinx, Markdown, MediaWiki,
    IPython notebook</li>
</ul>

<!-- !epop -->

<p>
<!-- !bslidecell 00 -->
<center><p><img src="fig/LaTeX_logo.jpg" align="bottom" width=120></p></center>
<!-- !eslidecell -->

<p>
<!-- !bslidecell 01 -->
<center><p><img src="fig/MS_Word_logo.jpg" align="bottom" width=80></p></center>
<!-- !eslidecell -->

<p>
<!-- !bslidecell 02 -->
<center><p><img src="fig/sphinx_logo.png" align="bottom" width=200></p></center>
<!-- !eslidecell -->

<p>
<!-- !bslidecell 10 -->
<center><p><img src="fig/markdown_logo.jpg" align="bottom" width=80></p></center>
<!-- !eslidecell -->

<p>
<!-- !bslidecell 11 -->
<center><p><img src="fig/MediaWiki_logo.jpg" align="bottom" width=80></p></center>
<!-- !eslidecell -->

<p>
<!-- !bslidecell 12 -->
<center><p><img src="fig/IPython_logo.png" align="bottom" width=300></p></center>
<!-- !eslidecell -->

<p>
<!-- !split -->

<h2>Scientific writing needs to address many new media  <a name="___sec1"></a></h2>
<p>
<!-- !bslidecell 00 -->

<ul>
 <li> Old days (1985-2005): BW for printing</li>
 <li> Now:</li>

<ol>
  <li> BW books</li>
  <li> Colorful books and PDFs</li>
  <li> Colorful PDFs with hyperlinks</li>
  <li> Designed web pages</li>
  <li> Wiki</li>
  <li> Blogg</li>
  <li> epub</li>
  <li> Next new fancy format</li>
</ol>

 <li> PC, iPad, phone, Kindle, ...</li>
 <li> LaTeX does not support all of this</li>
 <li> We need to write for multiple formats!</li>
</ul>

<!-- !eslidecell -->

<p>
<!-- !bslidecell 01 -->
<center><p><img src="fig/jungle_with_mess.jpg" align="bottom" width=500></p></center>
<!-- !eslidecell -->

<p>
<!-- !split -->

<h2>Popular tools anno 2012  <a name="___sec2"></a></h2>
<p>
<!-- !bpop -->

<ul>
 <li> <b>LaTeX</b>: de facto standard in math-instensive sciences</li>
 <li> <b>pdfLaTeX</b>: takes over (figures in png, pdf)</li>
 <li> <b>MS Word</b>: popular, but too clicky math support and ugly fonts</li>
 <li> <b>HTML with MathJax</b>: "full" LaTeX <em>math</em></li>
 <li> <b>Sphinx</b>:
   limited LaTeX math support, great support for web design</li>
 <li> <b>reStructuredText</b>: no math support, transforms to
   lots of formats (LaTeX, HTML, XML, Word, OpenOffice, ...)</li>
 <li> <b>Markdown</b>: email-style untagged formatting,
   limited LaTeX math support, transforms to
   lots of formats (LaTeX, HTML, XML, Word, OpenOffice, ...)</li>
 <li> <b>IPython notebooks</b>: combines Python code, interactivity,
   visualization, and Markdown code/math</li>
 <li> <b>MediaWiki</b>: good LaTeX math support (Wikipedia)</li>
 <li> Other <b>wiki</b> formats: no math support, great for collaborative editing</li>
 <li> <b>Wordpress</b>: supports LaTeX <em>formulas</em></li>
 <li> <b>Epydoc</b>: old tool for Python code documentation</li>
 <li> <b>Plain text for email</b> (no tagging)</li>
</ul>

<!-- !epop -->

<p>
<!-- !split -->

<p>

<h2>LaTeX is very rich; other tools support only some elements  <a name="___sec3"></a></h2>
<p>

<ul>
 <li> LaTeX inline math: works with all (LaTeX, MathJax, Sphinx, Markdown, MediaWiki)</li>
 <li> LaTeX equation math:</li>

<ul>
    <li> <b>LaTeX</b>: <tt>equation*</tt>, <tt>equation</tt>, <tt>align*</tt>, <tt>align</tt> +
      <tt>eqnarray</tt>, <tt>split</tt>, <tt>alignat</tt>, ... (numerous!)</li>
    <li> <b>MathJax</b>: <tt>equation*</tt>, <tt>equation</tt>, <tt>align*</tt>, <tt>align</tt></li>
    <li> <b>MediaWiki</b>: <tt>equation*</tt>, <tt>equation</tt>, <tt>align*</tt>, <tt>align</tt></li>
    <li> <b>Sphinx</b>: <tt>equation*</tt>, <tt>equation</tt>, <tt>align*</tt></li>
    <li> <b>Markdown</b>: <tt>equation*</tt>, <tt>equation</tt>, <tt>align*</tt> (but no labels)</li>
</ul>

</ul>

<!-- !split -->

<h2>LaTeX is very rich; other tools support only some elements  <a name="___sec4"></a></h2>
<p>
<!-- !bpop -->

<ul>
 <li> Figures: all</li>
 <li> Subfigures: LaTeX (<tt>subfigure</tt>)</li>
 <li> Movies: LaTeX (can run separately), just raw embedded HTML in others</li>
 <li> Floating computer code: LaTeX</li>
 <li> Fixed computer code: all</li>
 <li> Floating tables: LaTeX</li>
 <li> Fixed tables: all</li>
 <li> Algorithms: LaTeX</li>
 <li> Margin notes: LaTeX</li>
 <li> Footnotes: LaTeX, Sphinx, reStructuredText, MediaWiki</li>
 <li> Bibliography: LaTeX, Sphinx, reStructuredText, MediaWiki</li>
 <li> Hyperlinks: all (but not on paper!)</li>
</ul>

<!-- !epop -->

<p>
<!-- !bpop -->
Conclusion: Highly non-trivial to translate a LaTeX document into something
based on HTML and vice versa.
<!-- !epop -->

<p>
<!-- !split -->

<h2>Concerns I  <a name="___sec5"></a></h2>
<p>
<!-- !bpop -->

<ul>
 <li> Sphinx refers to figures by the caption (has to be short!) and
   strips away any math notation (avoid that!).</li>
 <li> Sphinx refers to sections by the title, but removes math in the
   reference, so avoid math in headlines.</li>
 <li> Algorithms must be written up using basic elements like lists or
   paragraphs with headings.</li>
 <li> Tables cannot be referred to by numbers and have to appear at
   fixed positions in the text.</li>
 <li> Computer code has to appear at fixed positions in the text.</li>
</ul>

<!-- !epop -->

<p>
<!-- !split -->

<h2>Concerns II  <a name="___sec6"></a></h2>
<p>
<!-- !bpop -->

<ul>
 <li> Footnotes must appear as part of the running text (e.g., sentences
   surrounded by parenthesis), since only a few formats support footnotes.</li>
 <li> Sphinx does not handle code blocks where the first line is indented.</li>
 <li> Multiple plots in the same figure: mount the plots to one image
   file and include this (<tt>montage</tt> for png, gif, jpeg; <tt>pdftk</tt>, <tt>pdfnup</tt>,
   and <tt>pdfcrop</tt> for PDF).</li>
 <li> Keys for items in the bibliography are made visible by Sphinx so
   "bibitems" a la BibTeX must look sensible and consistent.</li>
 <li> If you need several equations <em>numbered</em> in an <tt>align</tt> environment,
   recall that Sphinx, Markdown, and MediaWiki cannot handle this,
   although they have LaTeX math support.</li>
 <li> Markdown tolerates labels in equations but cannot refer to them.</li>
</ul>

<!-- !epop -->

<p>
<!-- !split -->

<h2>Concerns III  <a name="___sec7"></a></h2>
<p>
<!-- !bpop -->

<ul>
 <li> Index words can appear anywhere in LaTeX, but should be outside
   paragraphs in other tools.</li>
 <li> References to tables, program code and algorithms can only be
   made in LaTeX.</li>
 <li> Figures are floating in LaTeX, but fixed in other tools, so place
   figures exactly where they are needed the first time.</li>
 <li> Curve plots with color lines do not work well in black-and-white
   printing. Make sure plots makes sense in color and BW (e.g., by
   using colors <em>and</em> markers).</li>
</ul>

<!-- !epop -->

<p>
<!-- !split -->

<h2>Solution I: Use a format that translates to many  <a name="___sec8"></a></h2>
<p>

<ul>
 <li> Sphinx can do nice HTML, LaTeX, epub, (almost) plain text,
   man pages, Gnome devhelp files, Qt help files, texinfo, JSON</li>
 <li> Markdown can do LaTeX, HTML, MS Word, OpenOffice, XML,
   reStructuredText, epub, DocBook, ... but not Sphinx</li>
 <li> IPython notebook: can do LaTeX, reStructuredText, HTML, PDF,
   Python script</li>
 <li> Sphinx and Markdown has some limited math support</li>
</ul>

<!-- !split -->

<h2>Solution II: Use Doconce  <a name="___sec9"></a></h2>
<p>
Doconce offers minimalistic typing, great flexibility wrt format,
especially for scientific writing.

<p>

<ul>
 <li> Can generate LaTeX, HTML, Sphinx, Markdown, MediaWiki, Google wiki,
   Creole wiki, reST, plain text</li>
 <li> Particularly good support for math and code</li>
 <li> Great flexibility for typesetting code</li>
 <li> Made for science books <em>and</em> smaller teaching modules</li>
 <li> Targets traditional books, electronic PDF, PDF for phones,
   web pages, Google and Wordpress blogs (with math and code)</li>
 <li> Support for code snippets from files, embedded movies, warnings/hint/info,
   generalized links</li>
 <li> Support for HTML5 slides - short way from prose to slides</li>
 <li> Integrates with preprocessors: preprocess and mako</li>
 <li> Handles multiple formats for figures</li>
 <li> Between Mardown and Sphinx wrt tagging (and richness)</li>
</ul>

<!-- !split -->

<h2>Doconce demo  <a name="___sec10"></a></h2>
<p>
<a href="http://hplgit.github.com/teamods/writing_reports/"><tt>http://hplgit.github.com/teamods/writing_reports/</tt></a>

<p>

<ul>
 <li> <a href="http://hplgit.github.com/teamods/writing_reports/report_do.html">HTML with MathJax</a></li>
 <li> <a href="http://hplgit.github.com/teamods/writing_reports/report.pdf">PDF from LaTeX</a></li>
 <li> <a href="http://hplgit.github.com/teamods/writing_reports/sphinx-agni/index.html">Sphinx (agni theme)</a></li>
 <li> <a href="http://hplgit.github.com/teamods/writing_reports/sphinx-pyramid/index.html">Sphinx (pyramid theme)</a></li>
 <li> <a href="http://hplgit.github.com/teamods/writing_reports/sphinx-classy/index.html">Sphinx (classy theme)</a></li>
 <li> <a href="http://hplgit.github.com/teamods/writing_reports/sphinx-fenics_minimal/index.html">Sphinx (fenics theme)</a></li>
 <li> <a href="http://hplgit.github.com/teamods/writing_reports/sphinx-fenics_minimal/index.html">Sphinx (redcloud theme)</a></li>
 <li> <a href="http://hplgit.github.com/teamods/writing_reports/report.do.txt.html">Doconce source</a></li>
 <li> <a href="http://code.google.com/p/doconce/wiki/Tutorial">Doconce tutorial</a></li>
</ul>

<!-- !split -->

<p>

<h1>A tour of Doconce  <a name="___sec11"></a></h1>
<p>
<!-- !split -->

<h2>Doconce: title, authors, date, toc  <a name="___sec12"></a></h2>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">TITLE: Some Title
AUTHOR: name1 at institution1, with more info, and institution2
AUTHOR: name2 email:name2@web.com at institution
DATE: today

# A table of contents is optional:
TOC: on
</pre></div>
<p>


<table width="95%" border="0">
<tr>
<td width="25" align="center" valign="top">
<img src="https://doconce.googlecode.com/hg/bundled/html_images/lyx_notice.png" hspace="5" alt="Notice"></td>
<th align="left" valign="middle"><b>Notice</b></th>
</tr>
<tr>
<td>&nbsp;</td>
<td align="left" valign="top">
<p>Title and authors must have all information <em>on a single line</em>!</p>
</td>
</tr>
</table>
<p>
<!-- !split -->

<h2>Doconce: abstract  <a name="___sec13"></a></h2>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">__Abstract.__
Here goes the abstract...
</pre></div>
<p>

Or:
<p>

<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">__Summary.__
Here goes the summary...
</pre></div>
<p>

<!-- !split -->

<h2>Doconce: section headings  <a name="___sec14"></a></h2>
<p>
Headings are surrounded by <tt>=</tt> signs:
<p>

<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">========= This is an H1/chapter heading =========

======= This is an H2/section heading =======

===== This is an H3/subsection heading =====

=== This is an H4/paragraph heading ===

__This is a paragraph heading.__
</pre></div>
<p>

Result:

<p>

<h1>This is an H1/chapter heading  <a name="___sec15"></a></h1>
<p>

<h2>This is an H2/section heading  <a name="___sec16"></a></h2>
<p>

<h3>This is an H3/subsection heading  <a name="___sec17"></a></h3>
<p>

<h4>This is an H4/paragraph heading  <a name="___sec18"></a></h4>
<p>
<b>This is a paragraph heading.</b> <p>

<!-- !split -->

<h2>Doconce: markup and lists  <a name="___sec19"></a></h2>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"> * Bullet list items start with `*`
   and may span several lines
 * Ordered (enumerated) list items start with `o`
 * *Emphasized words* are possible
 * _Boldface words_ are also possible
 * `inline verbatim code` is featured
   * sublists too
   * just indent...
</pre></div>
<p>

This gets rendered as

<p>

<ul>
 <li> Bullet lists start with <tt>*</tt>
   and may span several lines</li>
 <li> Ordered (enumerated) list items start with <tt>o</tt></li>
 <li> <em>Emphasized words</em> are possible</li>
 <li> <b>Boldface words</b> are also possible</li>
 <li> <tt>inline verbatim code</tt> is featured</li>

<ul>
   <li> sublists too</li>
   <li> just indent...</li>
</ul>

</ul>

<!-- !split -->

<h2>Doconce: labels, references, index items  <a name="___sec20"></a></h2>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"># Insert index items in the source
idx{key word1} idx{key word2}

# Label
===== Some section =====
label{this:section}

# Make reference
As we saw in Section ref{this:section}, references, index
items and labels follow a syntax similar to LaTeX
but without backslashes.

# Make reference to equations
See \eqref{eq1}-\eqref{myeq}.

# Make hyperlink
&quot;some link text&quot;: &quot;http://code.google.com/p/doconce/&quot;

# Hyperlink with complete URL as link text
URL: &quot;http://code.google.com/p/doconce/&quot;
</pre></div>
<p>

<!-- !split -->

<h2>Doconce: figures and movies  <a name="___sec21"></a></h2>
<p>

<table width="95%" border="0">
<tr>
<td width="25" align="center" valign="top">
<img src="https://doconce.googlecode.com/hg/bundled/html_images/lyx_notice.png" hspace="5" alt="Notice"></td>
<th align="left" valign="middle"><b>Notice</b></th>
</tr>
<tr>
<td>&nbsp;</td>
<td align="left" valign="top">
<p>Figure with HTML and LaTeX info, and caption, <em>all on one line</em>:</p>
</td>
</tr>
</table>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">FIGURE: [figdir/myfig, width=300 frac=1.2] My caption. label{fig1}

# This figure will be 300 pixels wide in HTML and span 1.2 times
# the linewidth in LaTeX.
</pre></div>
<p>

Movies are also supported:

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">MOVIE: [http://www.youtube.com/embed/P8VcZzgdfSc, width=420 height=315]
</pre></div>
<p>
and rendered as

<p>

<iframe width="420" height="315" src="http://www.youtube.com/embed/P8VcZzgdfSc" frameborder="0" allowfullscreen></iframe>


<p>
<!-- !split -->

<h2>Doconce: math  <a name="___sec22"></a></h2>
<p>
Inline math as in LaTeX:

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">...where $a=\int_{\Omega}fdx$ is an integral.
</pre></div>
<p>
gets rendered as ...where \( a=\int_{\Omega}fdx \) is an integral.

<p>

An equation environment is surrounded by <tt>!bt</tt> and <tt>!et</tt> tags,
the rest is plain LaTeX:

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">!bt
\begin{align}
\frac{\partial u}{\partial t} &amp;= \nabla^2 u,
label{a:eq}\\
\nabla\cdot\pmb{v} &amp; = 0
label{b:eq}
\end{align}
!et
</pre></div>
<p>
which is rendered as

<p>
$$
\begin{align}
\frac{\partial u}{\partial t} &= \nabla^2 u,
\label{a:eq}\\
\nabla\cdot\pmb{v} & = 0
\label{b:eq}
\end{align}
$$


<p>
<!-- !split -->

<h2>Doconce: math flexibility  <a name="___sec23"></a></h2>
<p>
Limit math environments to

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">\[ ... \]

\begin{equation*}
\end{equation*}

\begin{equation}
\end{equation}

\begin{align*}
\end{align*}

\begin{align}
\end{align}
</pre></div>
<p>

Even though Sphinx, Markdown, and MediaWiki have problems with
the latter, Doconce splits it into separate, single equations
such that align with labels works accross formats.

<p>
<!-- !split -->

<h2>Doconce: displaying code  <a name="___sec24"></a></h2>
<p>
Code is enclosed in <tt>!bc</tt> and <tt>!ec</tt> tags:

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">!bc pycod
def solver(I, a, T, dt, theta):
    &quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;
    dt = float(dt)           # avoid integer division
    N = int(round(T/dt))     # no of time intervals
    T = N*dt                 # adjust T to fit time step dt
    u = zeros(N+1)           # array of u[n] values
    t = linspace(0, T, N+1)  # time mesh

    u[0] = I                 # assign initial condition
    for n in range(0, N):    # n=0,1,...,N-1
        u[n+1] = (1 - (1-theta)*a*dt)/(1 + theta*dt*a)*u[n]
    return u, t
!ec
</pre></div>
<p>
This gets rendered as

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%"><span style="color: #8B008B; font-weight: bold">def</span> <span style="color: #008b45">solver</span>(I, a, T, dt, theta):
    <span style="color: #CD5555">&quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;</span>
    dt = <span style="color: #658b00">float</span>(dt)           <span style="color: #228B22"># avoid integer division</span>
    N = <span style="color: #658b00">int</span>(<span style="color: #658b00">round</span>(T/dt))     <span style="color: #228B22"># no of time intervals</span>
    T = N*dt                 <span style="color: #228B22"># adjust T to fit time step dt</span>
    u = zeros(N+<span style="color: #B452CD">1</span>)           <span style="color: #228B22"># array of u[n] values</span>
    t = linspace(<span style="color: #B452CD">0</span>, T, N+<span style="color: #B452CD">1</span>)  <span style="color: #228B22"># time mesh</span>

    u[<span style="color: #B452CD">0</span>] = I                 <span style="color: #228B22"># assign initial condition</span>
    <span style="color: #8B008B; font-weight: bold">for</span> n <span style="color: #8B008B">in</span> <span style="color: #658b00">range</span>(<span style="color: #B452CD">0</span>, N):    <span style="color: #228B22"># n=0,1,...,N-1</span>
        u[n+<span style="color: #B452CD">1</span>] = (<span style="color: #B452CD">1</span> - (<span style="color: #B452CD">1</span>-theta)*a*dt)/(<span style="color: #B452CD">1</span> + theta*dt*a)*u[n]
    <span style="color: #8B008B; font-weight: bold">return</span> u, t
</pre></div>
<p>

The <tt>!bc</tt> command can be followed by a specification of the computer
language: <tt>pycod</tt> for Python code snippet, <tt>pypro</tt> for complete Python
program, <tt>fcod</tt> for Fortran snippet, <tt>fpro</tt> for Fortran program, and so
forth (<tt>c</tt> for C, <tt>cpp</tt> for C++, <tt>sh</tt> for Unix shells, <tt>m</tt> for Matlab).

<p>

<!-- !split -->

<h2>Doconce: copying code from source files  <a name="___sec25"></a></h2>
<p>
We recommend to copy as much code as possible directly from the
source files:

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">@@@CODE path/to/file
@@@CODE path/to/file   fromto: start-regex@end-regex
</pre></div>
<p>
For example, copying a code snippet starting with <tt>def solver(</tt> and
ending with (line not included) <tt>def next(x, y,</tt> is specified by
start and end regular expressions:

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">@@@CODE src/dc_mod.py  fromto: def solver\(@def next\(x,\s*y,
</pre></div>
<p>

Typesetting of code is implied by the file extension:

<p>

<ul>
 <li> <tt>.py</tt>: <tt>pypro</tt> if complete file, <tt>pycod</tt> if snippet</li>
 <li> <tt>.pyopt</tt>: visualized execution via the <a href="http://pythontutor.com">Online Python Tutor</a></li>
 <li> <tt>.f</tt>, <tt>.f90</tt>, <tt>f.95</tt>: <tt>fpro</tt> and <tt>fcod</tt></li>
 <li> <tt>.cpp</tt>, <tt>.cxx</tt>: <tt>cpppro</tt> and <tt>cppcod</tt></li>
 <li> <tt>.c</tt>: <tt>cpro</tt> and <tt>ccod</tt></li>
 <li> <tt>.*sh</tt>: <tt>shpro</tt> and <tt>shcod</tt></li>
 <li> <tt>.m</tt>: <tt>mpro</tt> and <tt>mcod</tt></li>
 <li> <tt>ptex2tex</tt> can be used to choose between 40+ typesettings of
   computer code in LaTeX</li>
 <li> <tt>pygments</tt> is used for code typesetting in HTML (about 10 different styles)</li>
</ul>

<!-- !split -->

<h2>Doconce: displaying interactive demo code  <a name="___sec26"></a></h2>
<p>
With <tt>!bc pyoptpro</tt> or a file <tt>*.pyopt</tt>, the code applies the
<a href="http://pythontutor.com">Online Python Tutor</a> for displaying
program flow and state of variables:

<p>


<iframe width="950" height="500" frameborder="0"
        src="http://pythontutor.com/iframe-embed.html#code=def+solver%28I%2C+a%2C+T%2C+dt%2C+theta%29%3A%0A++++dt+%3D+float%28dt%29%0A++++N+%3D+int%28round%28T%2Fdt%29%29%0A++++T+%3D+N%2Adt%0A++++u+%3D+%5B0.0%5D%2A%28N%2B1%29%0A++++t+%3D+%5Bi%2Adt+for+i+in+range%28N%2B1%29%5D%0A%0A++++u%5B0%5D+%3D+I%0A++++for+n+in+range%280%2C+N%29%3A%0A++++++++u%5Bn%2B1%5D+%3D+%281+-+%281-theta%29%2Aa%2Adt%29%2F%281+%2B+theta%2Adt%2Aa%29%2Au%5Bn%5D%0A++++return+u%2C+t%0A%0Au%2C+t+%3D+solver%28I%3D1%2C+a%3D1%2C+T%3D3%2C+dt%3D1.%2C+theta%3D0.5%29%0Aprint+u&curInstr=0&py=2&cumulative=false">
</iframe>
<p>

<!-- !split -->

<h2>Doconce: tables  <a name="___sec27"></a></h2>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">  |--------------------------------|
  |time  | velocity | acceleration |
  |---r-------r-----------r--------|
  | 0.0  | 1.4186   | -5.01        |
  | 2.0  | 1.376512 | 11.919       |
  | 4.0  | 1.1E+1   | 14.717624    |
  |--------------------------------|
</pre></div>
<p>
Gets rendered as

<p>
<table border="1">
<tr><td align="center"><b>     time     </b></td> <td align="center"><b>   velocity   </b></td> <td align="center"><b> acceleration </b></td> </tr>
<tr><td align="right">   0.0             </td> <td align="right">   1.4186          </td> <td align="right">   -5.01           </td> </tr>
<tr><td align="right">   2.0             </td> <td align="right">   1.376512        </td> <td align="right">   11.919          </td> </tr>
<tr><td align="right">   4.0             </td> <td align="right">   1.1E+1          </td> <td align="right">   14.717624       </td> </tr>
</table>
<p>

<!-- !split -->

<h2>Doconce: newcommands for math  <a name="___sec28"></a></h2>
<p>

<ul>
 <li> <tt>newcommands*.tex</tt> files contain newcommands</li>
 <li> Used directly in LaTeX</li>
 <li> Substitution made for many other formats</li>
</ul>

<!-- !split -->

<h2>Doconce: exercises  <a name="___sec29"></a></h2>
<p>
Doconce offers a special format for <em>exercises</em>, <em>problems</em>, <em>projects</em>,
and <em>examples</em>:

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">===== Problem: Flip a Coin =====
label{demo:ex:1}

files = flip_coin.py, flip_coin.pdf
solutions = mysol.txt, mysol_flip_coin.py
keywords = random numbers; Monte Carlo simulation

!bsubex
Make a program that simulates flipping a coin $N$ times.

!bhint
Use `r = random.random()` and define head as `r &lt;= 0.5`.
!ehint
!esubex

!bsubex
Compute the probability of getting heads.

!bans
A short answer: 0.5.
!eans

!bsol
A full solution to this subexercise can go here.
!esol
!esubex

!bsubex
Make another program that computes the probability
of getting at least three heads out of 5 throws.
!esubex
</pre></div>
<p>

Solutions/answers can easily be left out of the document.

<p>
<!-- !split -->

<h2>Doconce: exercises  <a name="___sec30"></a></h2>
<p>
Last page gets rendered as follows:

<p>

<!-- --- begin exercise -->

<p>

<h3>Problem 1: Flip a Coin <a name="demo:ex:1"></a></h3>
<!-- keywords = random numbers; Monte Carlo simulation -->

<p>

<b>a)</b> Make a program that simulates flipping a coin \( N \) times.

<p>
<b>Hint.</b> Use <tt>r = random.random()</tt> and define head as <tt>r <= 0.5</tt>.

<p>
<b>b)</b> Compute the probability of getting heads.

<p>
<!-- --- begin short answer in exercise -->

<p>
<b>Answer.</b> A short answer: 0.5.
<!-- --- end short answer in exercise -->

<p>
<!-- --- begin solution of exercise -->

<p>
<b>Solution.</b> A full solution to this subexercise can go here.

<p>
<!-- --- end solution of exercise -->

<p>
<b>c)</b> Make another program that computes the probability
of getting at least three heads out of 5 throws.

<p>
Filenames: <tt>flip_coin.py</tt>, <tt>flip_coin.pdf</tt>.
<!-- solution files: mysol.txt, mysol_flip_coin.py -->

<p>
<!-- --- end of exercise -->

<p>

<!-- !split -->

<h2>Doconce: exercises  <a name="___sec32"></a></h2>
<p>
All <em>exercises</em>, <em>problems</em>, and <em>projects</em> in a document are parsed
and available in a data structure (list of dicts) for further
processing (e.g., making a book of problems).

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">[{&#39;answer&#39;: &#39;&#39;,
  &#39;closing_remarks&#39;: &#39;&#39;,
  &#39;file&#39;: [&#39;flip_coin.py&#39;, &#39;flip_coin.pdf&#39;],
  &#39;heading&#39;: &#39;=====&#39;,
  &#39;hints&#39;: [],
  &#39;keywords&#39;: [&#39;random numbers&#39;, &#39;Monte Carlo simulation&#39;],
  &#39;label&#39;: &#39;demo:ex:1&#39;,
  &#39;no&#39;: 1,
  &#39;solution&#39;: &#39;&#39;,
  &#39;solution_file&#39;: [&#39;mysol.txt&#39;, &#39;mysol_flip_coin.py&#39;],
  &#39;subex&#39;: [{&#39;answer&#39;: &#39;&#39;,
             &#39;file&#39;: None,
             &#39;hints&#39;: [&#39;Use `r = random.random()` ...&#39;],
             &#39;solution&#39;: &#39;&#39;,
             &#39;text&#39;: &#39;Make a program that simulates ...&#39;},
            {&#39;answer&#39;: &#39;A short answer: 0.5.&#39;,
             &#39;file&#39;: None,
             &#39;hints&#39;: [],
             &#39;solution&#39;: &#39;A full solution to this ...&#39;,
             &#39;text&#39;: &#39;Compute the probability of ...&#39;},
            {&#39;answer&#39;: &#39;&#39;,
             &#39;file&#39;: None,
             &#39;hints&#39;: [],
             &#39;solution&#39;: &#39;&#39;,
             &#39;text&#39;: &#39;Make another program that computes ...&#39;}],
  &#39;text&#39;: &#39;&#39;,
  &#39;title&#39;: &#39;Flip a Coin&#39;,
  &#39;type&#39;: &#39;Problem&#39;}]
</pre></div>
<p>

<!-- !split -->

<h2>Doconce: use of preprocessors  <a name="___sec33"></a></h2>
<p>

<ul>
 <li> Simple if-else tests a la C preprocessor</li>
 <li> <tt>FORMAT</tt> variable can be used to test on format</li>

<ul>
    <li> if latex/pdflatex do one sort of code (raw LaTeX)</li>
    <li> if html, do another type of code (raw HTML)</li>
</ul>

 <li> Easy to comment out large portions of text</li>
 <li> Easy to make different versions of the document</li>
 <li> The mako preprocessor is really powerful - gives a
   complete programming language inside the document!</li>
</ul>

<!-- !split -->

<h2>Doconce: slides  <a name="___sec34"></a></h2>
<p>
Very effective way to generate slides from running text:

<p>

<ul>
 <li> Take a copy of your Doconce prose</li>
 <li> Strip off as much text as possible</li>
 <li> Emphasize key points in bullet items</li>
 <li> Focus on figures and movies</li>
 <li> Focus on key equations</li>
 <li> Focus on key code snippets</li>
 <li> Insert <tt>!split</tt> wherever you want a new slide to
   begin</li>
 <li> Insert <tt>!bpop</tt> and <tt>!epop</tt> around elements to pop up
   in sequence</li>
 <li> Use 7 <tt>=</tt> or 5 <tt>=</tt> in headings (H2 or H3)</li>
 <li> Slides are made with HTML5 tools such as reveal.js, deck.js,
   csss, or dzslides</li>
</ul>

<!-- !split -->

<h2>Doconce: example on slide code  <a name="___sec35"></a></h2>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">!split
======= Headline =======

 * Key point 1
 * Key point 2
 * Key point 3 takes very much more text to explain because
   this point is really comprehensive, and although long
   bullet points are not recommended in general, we need
   it here for demonstration purposes

FIGURE: [fig/teacher1, width=100]

Key equation:

$$ -\nabla^2 u = f \quad\hbox{in }\Omega $$


And maybe a final comment?

!split
======= Next slide... =======
</pre></div>
<p>

<!-- !split -->

<h2>Doconce: example on slide code  <a name="___sec36"></a></h2>
<p>
Last page gets rendered to

<p>

<h2>Headline  <a name="___sec37"></a></h2>
<p>

<ul>
 <li> Key point 1</li>
 <li> Key point 2</li>
</ul>

<center><p><img src="fig/teacher1.gif" align="bottom" width=100,></p></center>

<p>
Key equation:

<p>
$$ -\nabla^2 u = f \quad\hbox{in }\Omega $$


<p>
And maybe a final comment?

<p>
<!-- !split -->

<h2>Doconce: example on slide code with cells  <a name="___sec38"></a></h2>
<p>
One can introduce a table-like layout with MxN cells and
put slide elements in various cell. A cell with position
MN is surrounded by <tt>!bslidecell MN</tt> and <tt>!eslidecell</tt>
tags. Below is an example with a bullet list to the left and
a figure to the right (two cells, numbered 00 and 01).

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">!split
======= Headline =======

!bslidecell 00
!bpop
 * Key point 1
 * Key point 2
 * Key point 3 takes very much more text to explain because
   this point is really comprehensive, and although long
   bullet points are not recommended in general, we need
   it here for demonstration purposes
!epop

!bpop
!bt
\[ -\nabla^2 u = f \quad\hbox{in }\Omega \]
!et
!epop

!eslidecell

!bslidecell 01
FIGURE: [fig/broken_pen_and_paper, width=400, frac=0.8]
!eslidecell

!split
======= Next slide... =======
</pre></div>
<p>

<!-- !split -->

<h2>Doconce: example on slide code  <a name="___sec39"></a></h2>
<p>
Last page gets rendered to

<p>

<h2>Headline  <a name="___sec40"></a></h2>
<p>
<!-- !bslidecell 00 -->
<!-- !bpop -->

<ul>
 <li> Key point 1</li>
 <li> Key point 2</li>
 <li> Key point 3 takes very much more text to explain because
   this point is really comprehensive, and although long
   bullet points are not recommended in general, we need
   it here for demonstration purposes</li>
</ul>

<!-- !epop -->

<p>
<!-- !bpop -->
$$ -\nabla^2 u = f \quad\hbox{in }\Omega $$

<!-- !epop -->

<p>
<!-- !eslidecell -->

<p>
<!-- !bslidecell 01 -->
<center><p><img src="fig/broken_pen_and_paper.jpg" align="bottom" width=400></p></center>
<!-- !eslidecell -->

<p>

<!-- !split -->

<h2>Doconce: slide styles  <a name="___sec41"></a></h2>
<p>
<!-- !bpop -->

<ul>
 <li> Supported HTML5 packages:</li>

<ul>
   <li> <a href="http://lab.hakim.se/reveal-js/">reveal.js</a></li>
   <li> <a href="http://imakewebthings.com/deck.js/">deck.js</a></li>
   <li> <a href="http://paulrouget.com/dzslides/">dzslides</a></li>
   <li> <a href="http://leaverou.github.com/csss/#intro">csss</a></li>
   <li> <a href="http://code.google.com/p/html5slides/">html5slides</a> (experimental)</li>
</ul>

 <li> <b>Problem</b>: each package has its own syntax (though similar)</li>

<ul>
   <li> <b>Solution</b>: slide code is autogenerated from compact Doconce syntax</li>
</ul>

 <li> <b>Problem</b>: reveal and deck have numerous styles</li>

<ul>
   <li> <b>Solution</b>: easy <a href="demo/index.html">to autogenerate all styles</a> for a talk</li>
</ul>

 <li> <b>Problem</b>: HTML5 slides need many style files</li>

<ul>
   <li> <b>Solution</b>: autocopy all files to talk directory</li>
</ul>

 <li> <b>Problem</b>: original versions of the styles have too large fonts,
   centering, and other features not so suitable for lectures
   with much math and code</li>

<ul>
   <li> <b>Solution</b>: Doconce contains adjusted css files</li>
</ul>

</ul>

<!-- !epop -->

<p>

<!-- !split -->

<h2>Doconce: output in HTML  <a name="___sec42"></a></h2>
<p>
Run in terminal window:
<p>

<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">doconce format html doconcefile

# Solarized HTML style
doconce format html doconcefile --html-solarized

# Control pygments typesetting of code
doconce format html doconcefile --pygments-html-style=native

# Or use plain &lt;pre&gt; tag
doconce format html doconcefile --no-pygments-html

# Further making of slides
doconce slides_html doconcefile reveal --html-slide-theme=darkgray
</pre></div>
<p>

<!-- !split -->

<h2>Doconce: output for blogging  <a name="___sec43"></a></h2>
<p>
Two types of blogs are supported:

<p>

<ul>
 <li> Google's blogspot.com: just paste the raw HTML
   (full support of math and code)</li>
 <li> Wordpress: despite limited math, Doconce manipulates the math
   such that even <tt>equation</tt> and <tt>align</tt> work in Wordpress :-)</li>
</ul>

For wordpress, add <tt>--wordpress</tt>:
<p>

<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">doconce format html doconcefile --wordpress
</pre></div>
<p>
and paste the code into the text area.

<p>

<!-- !split -->

<h2>Doconce: output in pdfLaTeX  <a name="___sec44"></a></h2>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">doconce format pdflatex doconcefile

# Result: doconcefile.p.tex (ptex2tex file)
# Run either
ptex2tex doconcefile
# or
doconce ptex2tex doconcefile -DHELVETICA envir=minted

pdflatex doconcefile
bibtex doconcefile
pdflatex doconcefile

# More control of how code is typeset
doconce format pdflatex doconcefile --minted-latex-style=trac
doconce ptex2tex doconcefile envir=minted

doconce format pdflatex doconcefile
doconce ptex2tex doconcefile envir=ans:nt
</pre></div>
<p>

<!-- !split -->

<h2>Doconce: output in Sphinx  <a name="___sec45"></a></h2>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">doconce format sphinx doconcefile

# Autocreate sphinx directory
doconce sphinx_dir theme=pyramid doconcefile

# Copy files and build HTML document
python automake-sphinx.py

google-chrome sphinx-rootdir/_build/html/index.html
</pre></div>
<p>

Much easier than running the Sphinx tools manually!

<p>
<!-- !split -->

<h2>Doconce: output for wiki  <a name="___sec46"></a></h2>
<p>
Only MediaWiki supports math.

<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">doconce format mwiki doconcefile
</pre></div>
<p>

Recommended site:

<p>

<ul>
 <li> <a href="http://shoutwiki.com">ShoutWiki</a> for standard wikis</li>
</ul>

Publishing of "official" documents:

<p>

<ul>
 <li> <a href="http://en.wikibooks.org/wiki/Wikibooks:WIW">Wikibooks</a>
   (can test code in the "sandbox": <a href="http://en.wikibooks.org/wiki/Wikibooks"><tt>http://en.wikibooks.org/wiki/Wikibooks</tt></a>:Sandbox)</li>
 <li> Wikipedia</li>
</ul>

<!-- !split -->

<h2>Doconce: output in other formats  <a name="___sec47"></a></h2>
<p>


<!-- code typeset with pygments style "perldoc" -->
<div class="highlight" style="background: #eeeedd"><pre style="line-height: 125%">doconce format pandoc doconcefile  # (Pandoc extended) Markdown
doconce format gwiki  doconcefile  # Googlecode wiki
doconce format cwiki  doconcefile  # Creole wiki (Bitbucket)
doconce format rst    doconcefile  # reStructuredText
doconce format plain  doconcefile  # plain, untagged text for email
</pre></div>
<p>

<!-- !split -->

<h2>Doconce: installation  <a name="___sec48"></a></h2>
<p>

<ul>
 <li> Ubuntu: <tt>sudo apt-get install python-doconce</tt> (old version!)</li>
 <li> Source at <a href="http://code.google.com/p/doconce">Googlecode</a> (recommended!)</li>
 <li> Check out source, <tt>sudo python setyp.py install</tt></li>
 <li> Many <a href="https://doconce.googlecode.com/hg/doc/demos/manual/manual.html#___sec1">dependencies...</a></li>
 <li> Must have <tt>preprocess</tt> and <tt>mako</tt></li>
 <li> Need <tt>latex</tt>, <tt>sphinx</tt>, <tt>pandoc</tt>, etc. (see Installation in <a href="https://doconce.googlecode.com/hg/doc/demos/manual/manual.html#___sec1">manual</a>)</li>
 <li> Easy for slides: only <tt>preprocess</tt> is needed :-)</li>
</ul>

<!-- !split -->

<h2>Writing tips  <a name="___sec49"></a></h2>
<p>

<ul>
 <li> See the previous <em>Concerns I, II and III</em> slides for issues when writing
   for multiple formats. However: Doconce makes a fix so that Sphinx and
   other formats works with labels in align environments :-)</li>
 <li> Prepare figures in the right format: EPS for <tt>latex</tt>, PDF for <tt>pdflatex</tt>,
   PNG, GIF or JPEG for HTML formats (<tt>html</tt>, and HTML output from
   <tt>sphinx</tt>, <tt>rst</tt>, <tt>pandoc</tt>). One can omit the figure file extension and
   <tt>doconce</tt> will pick the most appropriate file for the given output format.</li>
 <li> Let plotting programs produce both PDF/EPS and PNG files.
   (Recall that PDF and EPS are vector graphics formats that can scale to
   any size with much higher quality than PNG or other bitmap formats.)</li>
 <li> Use <tt>doconce combine_images</tt> to combine several images into one.</li>
 <li> Use <tt>doconce spellcheck *.do.txt</tt> to automatically spellcheck files.</li>
</ul>

<!-- !split -->

<h2>Writing tips for sphinx and other formats  <a name="___sec50"></a></h2>
<p>
For output formats different from <tt>latex</tt>, <tt>pdflatex</tt>, and <tt>html</tt>, the
following points are important:

<p>

<ul>
 <li> Do not use math in section headings or figure captions if output in
   <tt>sphinx</tt> is wanted (such math are removed in references).</li>
 <li> Let all running text start in column 1 (<tt>sphinx</tt> is annoyed by intended
   lines).</li>
 <li> Use progressive section headings: after chapter (<tt>=========</tt>) comes
   section (<tt>=======</tt>), and then subsection (<tt>=====</tt>) before paragraph
   heading (<tt>===</tt>). "Jumps", say <tt>===</tt> after <tt>======</tt> works fine for
   <tt>latex</tt>, <tt>pdflatex</tt>, and <tt>html</tt>, but not for <tt>rst</tt> and <tt>sphinx</tt>.</li>
 <li> Place index entries (``) before the paragraph where they
   are introduced (not inside the text). Also place index entries before
   <tt>===</tt> headings.</li>
 <li> Be careful with labels in <tt>align</tt> math environments: <tt>pandoc</tt>
   and <tt>mwiki</tt> cannot refer to them.</li>
 <li> Always have a line of running text before a code snippet or program.</li>
 <li> Do not insert comments before intented text, such as computer code and
   lists.</li>
</ul>


<!-- ------------------- end of main content ----------------->
</body>
</html>
    

